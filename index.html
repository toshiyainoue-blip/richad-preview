<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>リッチアド テスト環境</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #eee;
      font-family: sans-serif;
    }
    #preview {
      width: 375px;
      margin: auto;
      background: #fff;
      border: 1px solid #ccc;
      min-height: 200px;
    }
  </style>
</head>
<body>

<h3>リッチアド プレビュー</h3>
<div id="preview"></div>

<script>
const params = new URLSearchParams(location.search);
const code = params.get("code");

if (code) {
  const html = decodeURIComponent(code);
  const container = document.getElementById("preview");

  // 一旦HTMLをDOM化
  const temp = document.createElement("div");
  temp.innerHTML = html;

  // scriptだけを「そのまま」再生成（補完・改変なし）
  const scripts = temp.querySelectorAll("script");

  scripts.forEach(oldScript => {
    const s = document.createElement("script");

    // srcあり
    if (oldScript.src) {
      s.src = oldScript.src;

      // ★ すべての属性をそのままコピー（補完しない）
      Array.from(oldScript.attributes).forEach(attr => {
        if (attr.name !== "src") {
          s.setAttribute(attr.name, attr.value);
        }
      });
    } 
    // インラインscript
    else {
      s.textContent = oldScript.textContent;
    }

    document.body.appendChild(s);
  });

  // HTML本体を反映
  container.appendChild(temp);
}
</script>

</body>
</html>
